<script>
function handleSubmit(event) {
  event.preventDefault();
  const author = document.getElementById('author').value.trim();
  const title = document.getElementById('title').value.trim();
  const type = document.getElementById('type').value;
  const content = document.getElementById('content').value.trim();

  fetch("https://script.google.com/macros/s/AKfycbwz-oSoqaQOZEvVkfpjHcdXZRNB-nexNJMiZjhF1H8hLg3ZOdGndL20FMaOiSeFq7qJ/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ author, title, type, content })
  })
  .then(() => {
    alert("‚úÖ Submitted successfully!");
    event.target.reset();
    loadArticles(); // Reload after submission
  })
  .catch(() => alert("‚ùå Submission failed."));
}

function loadArticles() {
  fetch("https://script.google.com/macros/s/AKfycbwz-oSoqaQOZEvVkfpjHcdXZRNB-nexNJMiZjhF1H8hLg3ZOdGndL20FMaOiSeFq7qJ/exec")
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById("articles");
      container.innerHTML = "";

      const authors = {};

      data.forEach(entry => {
        if (!authors[entry.author]) {
          authors[entry.author] = [];
        }
        authors[entry.author].push(entry);
      });

      Object.keys(authors).forEach(author => {
        const section = document.createElement("div");
        section.className = "author-section";
        section.setAttribute("data-author", author);
        section.innerHTML = `<h3>${author} <span class="article-tag">Author</span></h3>`;

        authors[author].forEach(item => {
          const button = document.createElement("button");
          button.className = "collapsible";
          button.innerHTML = `${item.type === "article" ? "üìò Essay" : "üìù Poem"}: ${item.title} <span class="article-tag">${item.type === "article" ? "‡≤≤‡≥á‡≤ñ‡≤® | Article" : "‡≤ï‡≤µ‡≤® | Poem"}</span>`;
          
          const contentDiv = document.createElement("div");
          contentDiv.className = "content";
          contentDiv.innerHTML = `<pre>${item.content}</pre>`;

          button.addEventListener("click", () => {
            button.classList.toggle("active");
            contentDiv.classList.toggle("open");
          });

          section.appendChild(button);
          section.appendChild(contentDiv);
        });

        container.appendChild(section);
      });
    })
    .catch(error => console.error("‚ùå Error loading articles:", error));
}

document.addEventListener("DOMContentLoaded", () => {
  loadArticles();
});
</script>
